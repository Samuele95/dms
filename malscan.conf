# ============================================
# Malscan Configuration File
# ============================================
# Copy this file to ~/.malscan.conf or /etc/malscan.conf
# Command-line options override these settings
#

# ============================================
# Database and Rules Paths
# ============================================

# ClamAV database directory
CLAMDB_DIR=/tmp/clamdb

# YARA rules base directory (Qu1cksc0pe)
YARA_RULES_BASE=/opt/Qu1cksc0pe/Systems

# Oledump YARA rules for document analysis
OLEDUMP_RULES=/opt/oledump

# YARA compiled rules cache directory
YARA_CACHE_DIR=/tmp/yara_cache

# ============================================
# Performance Settings
# ============================================

# Chunk size in MB for scanning (default: 500)
# Larger chunks use more memory but may be faster
CHUNK_SIZE=500

# Maximum parallel jobs for parallel scanning mode
# Recommended: number of CPU cores
MAX_PARALLEL_JOBS=4

# ============================================
# VirusTotal Integration
# ============================================

# VirusTotal API key (required for --virustotal option)
# Get your free API key at: https://www.virustotal.com/gui/join-us
# VT_API_KEY=your_api_key_here

# Rate limit for VirusTotal API (requests per minute)
# Free API: 4 req/min, Premium: higher limits
VT_RATE_LIMIT=4

# ============================================
# Logging Settings
# ============================================

# Log level: DEBUG, INFO, WARNING, ERROR
# DEBUG: Show all messages including debug info
# INFO: Normal operation messages (default)
# WARNING: Warnings and errors only
# ERROR: Errors only
LOG_LEVEL=INFO

# ============================================
# Portable Tools Settings
# ============================================

# Directory for portable tools (used with --portable flag)
# Tools are downloaded here if not available system-wide
PORTABLE_TOOLS_DIR=/tmp/malscan_portable_tools

# Tool versions for portable downloads
YARA_VERSION=4.5.0
CLAMAV_VERSION=1.3.1

# ============================================
# EWF/Forensic Image Support
# ============================================

# Enable EWF (Expert Witness Format) image support
EWF_SUPPORT=true

# Verify EWF hash before scanning (slower but forensically sound)
# Set to true to always verify, or use --verify-hash on command line
EWF_VERIFY_HASH=false

# Additional options to pass to ewfmount
# Example: EWF_MOUNT_OPTIONS="-f ewf"
EWF_MOUNT_OPTIONS=""

# Base directory for temporary mount points (EWF virtual devices)
TEMP_MOUNT_BASE=/tmp

# ============================================
# Scan Scope Settings
# ============================================

# Default scan mode: "full" (entire drive) or "slack" (unallocated only)
DEFAULT_SCAN_MODE=full

# Slack space extraction timeout in seconds
SLACK_EXTRACT_TIMEOUT=600

# Minimum slack space size in MB to analyze (skip if smaller)
SLACK_MIN_SIZE_MB=10

# Maximum number of files to carve/recover from slack space
MAX_CARVED_FILES=1000

# File carving tools to use (comma-separated): foremost,photorec,scalpel
# Note: photorec requires manual interaction, so only foremost is enabled by default
CARVING_TOOLS=foremost

# ============================================
# Forensic Analysis Settings
# ============================================

# Enable full forensic artifact analysis (all modules below)
FORENSIC_ANALYSIS=false

# Persistence mechanism scanning (registry, tasks, services)
PERSISTENCE_SCAN=false

# Execution artifact analysis (prefetch, amcache, shimcache)
EXECUTION_SCAN=false

# File anomaly detection (timestomping, ADS, suspicious paths)
FILE_ANOMALIES=false

# Reverse engineering triage (capa, imports, entropy)
RE_TRIAGE=false

# MFT and filesystem forensics
MFT_ANALYSIS=false

# RegRipper path (for persistence/execution analysis)
# REGRIPPER_PATH=/opt/regripper

# capa binary path (for RE triage)
# CAPA_PATH=/opt/capa/capa

# ============================================
# Display Options
# ============================================

# Disable colored output (equivalent to --no-color)
NO_COLOR=false

# High contrast mode - bold text only, no dim colors
HIGH_CONTRAST=false

# ============================================
# USB Kit Settings
# ============================================

# Auto-detect USB kit mode (if .dms_kit_manifest.json exists)
# Set to true to force USB mode detection at startup
USB_MODE=auto

# Kit mode: "auto", "minimal", or "full"
# auto: Detect from manifest
# minimal: Download tools on-demand
# full: Use bundled tools from USB
KIT_MODE=auto

# USB kit directories (relative to USB_ROOT when in USB mode)
USB_TOOLS_DIR=tools
USB_DATABASES_DIR=databases
USB_CACHE_DIR=cache
USB_OUTPUT_DIR=output

# Minimum free space required to build full kit (in MB)
KIT_MIN_FREE_SPACE_MB=2000

# ============================================
# USB Kit Update Settings
# ============================================

# Update ClamAV databases when --update-kit is run
USB_UPDATE_CLAMAV=true

# Update YARA rules when --update-kit is run
USB_UPDATE_YARA=true

# Update portable tools when --update-kit is run (slower)
USB_UPDATE_TOOLS=false

# Freshclam mirror for database updates
# Default uses ClamAV CDN, can set to local mirror for faster updates
# FRESHCLAM_MIRROR=https://database.clamav.net

# ============================================
# ISO Builder Settings
# ============================================

# Base Debian Live ISO URL (official Debian Live standard image)
DEBIAN_LIVE_URL=https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/debian-live-12.5.0-amd64-standard.iso

# Expected SHA256 of Debian Live ISO (for verification)
# Update this when DEBIAN_LIVE_URL changes
DEBIAN_LIVE_SHA256=

# ISO output filename pattern (VERSION replaced with DMS version)
ISO_OUTPUT_PATTERN=dms-forensic-VERSION.iso

# Additional packages to install in live system
# Space-separated list of Debian package names
ISO_EXTRA_PACKAGES="sleuthkit ewf-tools dc3dd exiftool testdisk"

# ISO build working directory (needs ~5GB free space)
ISO_WORK_DIR=/tmp/dms-iso-build

# Include ClamAV databases in ISO (increases size by ~350MB)
ISO_INCLUDE_CLAMAV_DB=true

# Include YARA rules in ISO (increases size by ~100MB)
ISO_INCLUDE_YARA_RULES=true

# ============================================
# Output Storage Settings
# ============================================

# Default output device (blank = auto-detect or prompt)
# OUTPUT_DEVICE=/dev/sdc1

# Default output path (alternative to device)
# OUTPUT_PATH=/mnt/forensic-output

# Use tmpfs (RAM) for output by default
# WARNING: Data lost on reboot!
OUTPUT_TMPFS=false

# Default mount point for output storage
OUTPUT_MOUNT_POINT=/mnt/dms-output

# Case directory naming pattern
# Available variables: %Y (year), %m (month), %d (day), %H (hour), %M (min), %S (sec)
CASE_NAME_PATTERN=case_%Y%m%d_%H%M%S

# Warn before using tmpfs output
OUTPUT_TMPFS_WARN=true

# ============================================
# Persistence Partition Settings
# ============================================

# Default persistence partition label
PERSISTENCE_LABEL=persistence

# Minimum size for persistence partition (in MB)
PERSISTENCE_MIN_SIZE_MB=512

# Filesystem type for persistence partition
PERSISTENCE_FSTYPE=ext4

# ============================================
# Notes
# ============================================
# - Lines starting with # are comments
# - Values can be quoted or unquoted
# - Environment variables are NOT expanded
# - Command-line options override config file settings
#
# Supported image formats:
#   - EWF/E01: Expert Witness Format (.E01, .E02, ... .Ex01, .L01, .Lx01)
#   - RAW: Raw disk images (.raw, .dd, .img, .bin)
#
# Example usage:
#   ./malware_scan.sh /dev/sdb1 --config /path/to/custom.conf
#   ./malware_scan.sh evidence.E01               # Auto-detect EWF
#   ./malware_scan.sh evidence.E01 --verify-hash # Verify integrity first
#   ./malware_scan.sh /dev/sdb1 --slack          # Slack space only scan
#   ./malware_scan.sh evidence.E01 --scan-mode slack  # EWF slack space scan
#
# Forensic analysis examples:
#   ./malware_scan.sh evidence.E01 --forensic-analysis  # Full forensic suite
#   ./malware_scan.sh /dev/sdb1 --persistence-scan      # Persistence only
#   ./malware_scan.sh evidence.E01 --re-triage          # RE triage on carved files
#   ./malware_scan.sh /dev/sdb1 --mft-analysis          # MFT/filesystem forensics
#
# USB Kit mode examples:
#   ./malware_scan.sh --build-full-kit --kit-target /media/usb  # Build full offline kit
#   ./malware_scan.sh --build-minimal-kit --kit-target /media/usb  # Build minimal kit
#   ./malware_scan.sh --update-kit                      # Update databases on USB kit
#   /media/usb/run-dms.sh /dev/sda1 --deep              # Run from USB kit
#
# ISO building examples:
#   ./malware_scan.sh --build-iso                       # Build bootable ISO
#   ./malware_scan.sh --build-iso --iso-output ~/dms.iso  # Specify output path
#   ./malware_scan.sh --flash-iso /dev/sdb --force      # Flash ISO to USB
#   ./malware_scan.sh --create-persistence /dev/sdb     # Add persistence partition
#
# Output storage examples:
#   ./malware_scan.sh /dev/sda1 --output-device /dev/sdc1  # Save to external USB
#   ./malware_scan.sh /dev/sda1 --output-path /mnt/output  # Save to specific path
#   ./malware_scan.sh /dev/sda1 --output-tmpfs             # RAM only (WARNING: lost on reboot)
#   ./malware_scan.sh /dev/sda1 --case-name investigation-2026  # Custom case name
#
